<!DOCTYPE html>
<html>
<head>
<title>Javascript Interface to the PiDrone</title>

<script type="text/javascript" src="three.js"></script>
<script type="text/javascript" src="eventemitter2.min.js"></script>
<script type="text/javascript" src="roslib.js"></script>
<script type="text/javascript" src="ros3d.js"></script>
<script type="text/javascript" src="Chart.bundle.min.js"></script>
<script type="text/javascript" src="mjpegcanvas.js"></script>
<script type="text/javascript" src="jquery-3.3.1.min.js"></script>
<script type="text/javascript" src="main.js"></script>
<link rel="stylesheet" href="main.css">


</head>

<body onload="init()">
  <h2>PiDrone Web Interface</h2>
<table summary="hostname" border="1" width=800>
<tr>
  <td>Hostname: <input type="text" id="hostname" value="192.168.42.1" onchange="init()"/><input type="submit" value="Connect" name="submit" onclick="init()"/></td>
<td>Connection status:  <div id="statusMessage">Initial value.</div>  
    Battery Voltage:<div id="vbat">???</div></td>
</tr>
</table>

<table summary="camera">



<tr>
<td>

<div id="irchart">
IR Readings
<canvas id="irChart" width="400" height="100"></canvas>
<script type="text/javascript">
var ctx = document.getElementById("irChart").getContext('2d');
var count = 0;
var windowSize = 500;
var irChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: Array(windowSize),
        datasets: [
          {
            label: 'IR Readings',
            data: Array(windowSize),
            borderWidth: 1,
            pointRadius: 0,
            //borderColor: 'rgba(0, 255, 0, 1)'
          },
          {
            label: 'Window',
            data: Array(windowSize),
            borderWidth: 1,
            pointRadius: 0,
            borderColor: 'rgba(255, 0, 0, 1)'
          },
        ]
    },
    options: {
        animation: {
           duration: 0,
        },
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero:true,
                    min: 0,
                    max: 1,
                }
            }],
            xAxes: [{
                display: false
            }]
        },
        legend: {
          display: false
        },
    }
});
for (i = 0; i < irChart.data.datasets[0].data.length; i++) {
  irChart.data.datasets[0].data[i] = 0;
  irChart.data.labels[i] = i;
  irChart.data.datasets[1].data[i] = 0;
}

</script>
</div>
</td>

<td>
Keyboard Control (with focus in the input box)
<br/>
<div class="tooltip">
<span class="tooltiptext">
<ul>
<li>;: Arm</li>
<li>space bar: Disarm</li>
<li>t: Takeoff</li>
<li>a: Yaw left</li>
<li>d: Yaw right</li>
<li>w: up</li>
<li>s: down</li>
<li>j: left</li>
<li>l: right</li>
<li>i: forward</li>
<li>k: backward</li>
<li>h: zero velocity</li>
<li>h: hover</li>
<li>r: set or reset the image/transform used for position hold</li>
<li>p: toggle whether to perform position hold or velocity zero</li>

</ul>
</span>
<br/>
<input type="submit" name="arm" value="Arm" onclick="publishArm()"/>
<input type="submit" name="disarm" value="Disarm" onclick="publishDisarm()"/>

<input type="text" name="keyboardCtrl" value="" />
</div>

</td>

</tr>


<tr>
<td><div id="imu"></div></td>
<td>

<!--<div id="camera"></div>-->

  <img id="cameraImage" alt="Camera image" src="nocamera.jpg" width=320/>
  <img id="firstImage" alt="First camera image" src="nocamera.jpg" width=320/>


</td>
</tr>

<tr><td>IMU
Topic: <input type="text" id="imutopic" value="/pidrone/imu_visualization_marker" onchange="markerUpdate()"/>
</td>
    <td>Camera.  Make sure you run <pre>rosrun web_video_server web_video_server</pre> and the image stream.
<br/>
Topic: <input type="text" id="imagetopic" value="/pidrone/picamera/image_raw" onchange="imageStream()"/>
</td>
</tr>
</table>

</body>
</html>
